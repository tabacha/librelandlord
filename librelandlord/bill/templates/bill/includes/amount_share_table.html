{% comment %}
Anteil am Gesamtrechnungsbetrag Tabelle (mit optionalem Renter-Filter)
HEATING_MIXED wird hier ausgeschlossen, da es eine eigene detaillierte Darstellung hat.
{% endcomment %}

<div class="section-group">
    <h3 class="section-title" style="margin-top: 30px;">Anteil am Gesamtrechnungsbetrag</h3>
    <table class="meter-readings-table">
        <thead>
            <tr>
                {% if not renter_filter_id %}<th>Mieter</th>
                <th>Zeitraum</th>{% endif %}
                <th>Kostenverteilung</th>
                <th>Gesamtrechnungsbetrag</th>
                <th></th>
                <th>Prozentsatz</th>
                <th></th>
                <th>Anteil</th>
            </tr>
        </thead>
        <tbody>
            {% for summary in cost_center_summaries %}
            {% if summary.cost_center_calculation and summary.cost_center.distribution_type != 'HEATING_MIXED' %}
            <tr style="background-color: #e8e8e8;">
                <td colspan="{% if not renter_filter_id %}8{% else %}6{% endif %}" style="font-weight: bold; padding: 8px;">
                    {{ summary.cost_center.text }}
                    <small style="font-weight: normal; color: #666;">
                        ({% if summary.cost_center.distribution_type == 'CONSUMPTION' %}Verbrauch{% elif summary.cost_center.distribution_type == 'TIME' %}nach Zeit{% elif summary.cost_center.distribution_type == 'AREA' %}nach Fläche{% else %}Direktzuordnung{% endif %})
                    </small>
                </td>
            </tr>
            {% for contrib in summary.cost_center_calculation.contribution_results %}
            {% if not renter_filter_id or contrib.renter_id == renter_filter_id %}
            <tr>
                {% if not renter_filter_id %}
                <td>
                    {% if contrib.renter_id %}
                    {{ contrib.renter_first_name }} {{ contrib.renter_last_name }}
                    {% elif contrib.is_special_designation %}
                    <em>{{ contrib.apartment_name }}</em>
                    {% else %}
                    <em>Leerstand {{ contrib.apartment_name }}</em>
                    {% endif %}
                </td>
                <td><small>{{ contrib.period_start|date:"d.m.Y" }} - {{ contrib.period_end|date:"d.m.Y" }}</small></td>
                {% endif %}
                <td>{% if summary.cost_center.distribution_type == 'CONSUMPTION' %}{{ contrib.consumption_calc_name }}{% else %}{{ summary.cost_center.text }} {{ contrib.apartment_name }}{% endif %}</td>
                <td class="consumption-cell">{{ summary.total_amount|floatformat:2 }} €</td>
                <td style="text-align: center;">×</td>
                <td class="consumption-cell">{{ contrib.percentage|floatformat:2 }} %</td>
                <td style="text-align: center;">=</td>
                <td class="consumption-cell"><strong>{{ contrib.euro_anteil|floatformat:2 }} €</strong></td>
            </tr>
            {% endif %}
            {% endfor %}
            <tr style="border-top:2px solid #333; background:#f8f9fa;">
                <td colspan="{% if not renter_filter_id %}7{% else %}5{% endif %}" style="text-align:right; font-weight:bold;">Summe</td>
                <td class="consumption-cell"><strong>{{ summary.sum_euro_anteil|floatformat:2 }} €</strong></td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
