{% comment %}Reusable calculation steps display for a contribution{% endcomment %}

<!-- Zählerstände Tabelle -->
{% for step in contrib.consumption_result.calculation_steps %}
{% include 'bill/includes/meter_readings_table.html' with step=step %}
{% endfor %}

<!-- Berechnungsschritte -->
{% for step in contrib.consumption_result.calculation_steps %}
{% if step.step_type == 'operation' %}
<div class="calculation-step step-{{ step.step_type }}">
    {% if step.operand1_label or step.operand2_label %}
    <div style="color: #666; font-style: italic; margin-bottom: 3px; font-size: 0.9em;">
        {% if step.operand1_label %}({{ step.operand1|floatformat:1 }} {{ step.operand1_unit }} = {{ step.operand1_label }}){% endif %}
        {% if step.operand2_label %}({{ step.operand2|floatformat:1 }} {{ step.operand2_unit }} = {{ step.operand2_label }}){% endif %}
    </div>
    {% endif %}
    <span class="calc-cell">
        {{ step.operand1|floatformat:1 }} {{ step.operand1_unit }} {{ step.operator }} {{ step.operand2|floatformat:1 }} {{ step.operand2_unit }} =
    </span>
    <span class="consumption-cell">
        <strong>{{ step.result|floatformat:1 }} {{ step.unit }}</strong>
    </span>
</div>
{% elif step.step_type == 'result' %}
{% comment %}Result step can be handled here if needed{% endcomment %}
{% endif %}
{% endfor %}

{% if contrib.consumption_result.calculation_str %}
<div class="calculation-step">
    <span class="calc-cell">{{ contrib.consumption_result.calculation_str_left }} =</span>
    <span class="consumption-cell"><strong>{{ contrib.consumption_result.calculation_result }}</strong></span>
</div>
{% endif %}
